function CellAutoCell(a,b){this.x=a,this.y=b,this.delays=[]}function CAWorld(a){this.width=24,this.height=24,this.options=a,this.wrap=!1,this.TOPLEFT={index:0,x:-1,y:-1},this.TOP={index:1,x:0,y:-1},this.TOPRIGHT={index:2,x:1,y:-1},this.LEFT={index:3,x:-1,y:0},this.RIGHT={index:4,x:1,y:0},this.BOTTOMLEFT={index:5,x:-1,y:1},this.BOTTOM={index:6,x:0,y:1},this.BOTTOMRIGHT={index:7,x:1,y:1},this.randomGenerator=Math.random;var b=[null,null,null,null,null,null,null,null];this.step=function(){var a,c;for(a=0;a<this.height;a++)for(c=0;c<this.width;c++)this.grid[a][c].reset();for(a=this.height-1;a>=0;a--)for(c=this.width-1;c>=0;c--){this.fillNeighbors(b,c,a);var d=this.grid[a][c];d.process(b);for(var e=0;e<d.delays.length;e++)d.delays[e].steps--,d.delays[e].steps<=0&&(d.delays[e].action(d),d.delays.splice(e,1),e--)}};var c=[{x:-1,y:-1},{x:0,y:-1},{x:1,y:-1},{x:-1,y:0},{x:1,y:0},{x:-1,y:1},{x:0,y:1},{x:1,y:1}];if(this.fillNeighbors=function(a,b,d){for(var e=0;e<c.length;e++){var f=b+c[e].x,g=d+c[e].y;this.wrap&&(f=(f+this.width)%this.width,g=(g+this.height)%this.height),!this.wrap&&(0>f||0>g||f>=this.width||g>=this.height)?a[e]=null:a[e]=this.grid[g][f]}},this.initialize=function(a){a.sort(function(a,b){return a.distribution>b.distribution?1:-1});for(var b=0,c=0;c<a.length;c++)b+=a[c].distribution,a[c].distribution=b;this.grid=[];for(var d=0;d<this.height;d++){this.grid[d]=[];for(var e=0;e<this.width;e++){var f=100*this.randomGenerator();for(c=0;c<a.length;c++)if(f<=a[c].distribution){this.grid[d][e]=new this.cellTypes[a[c].name](e,d);break}}}},this.cellTypes={},this.registerCellType=function(a,b,c){if(this.cellTypes[a]=function(a,d){if(CellAutoCell.call(this,a,d),c&&c.call(this,a,d),b)for(var e in b)"function"!=typeof b[e]&&("object"==typeof b[e]?this[e]=JSON.parse(JSON.stringify(b[e])):this[e]=b[e])},this.cellTypes[a].prototype=Object.create(CellAutoCell.prototype),this.cellTypes[a].prototype.constructor=this.cellTypes[a],this.cellTypes[a].prototype.cellType=a,b)for(var d in b)"function"==typeof b[d]&&(this.cellTypes[a].prototype[d]=b[d])},a)for(var d in a)this[d]=a[d]}CellAutoCell.prototype.process=function(a){},CellAutoCell.prototype.countSurroundingCellsWithValue=function(a,b){for(var c=0,d=0;d<a.length;d++)null!==a[d]&&a[d][b]&&c++;return c},CellAutoCell.prototype.delay=function(a,b){this.delays.push({steps:a,action:b})},CellAutoCell.prototype.reset=function(a){},CellAutoCell.prototype.getSurroundingCellsAverageValue=function(a,b){for(var c=0,d=0;d<a.length;d++)null===a[d]||!a[d][b]&&0!==a[d][b]||(c+=a[d][b]);return c/a.length},CAWorld.prototype.initializeFromGrid=function(a,b){this.grid=[];for(var c=0;c<this.height;c++){this.grid[c]=[];for(var d=0;d<this.width;d++)for(var e=0;e<a.length;e++)if(a[e].gridValue===b[c][d]){this.grid[c][d]=new this.cellTypes[a[e].name](d,c);break}}},CAWorld.prototype.createGridFromValues=function(a,b){for(var c=[],d=0;d<this.height;d++){c[d]=[];for(var e=0;e<this.width;e++){c[d][e]=b;for(var f=this.grid[d][e],g=0;g<a.length;g++)f.cellType==a[g].cellType&&f[a[g].hasProperty]&&(c[d][e]=a[g].value)}}return c},function(){var a={World:CAWorld,Cell:CellAutoCell};"function"==typeof define&&define.amd?define("CellAuto",function(){return a}):"undefined"!=typeof module&&module.exports?module.exports=a:window.CellAuto=a}();